# ─────────────────────────────────────────────────────────────────────────────
# MediaRenamer — docker compose
#
# Quick start:
#   docker compose up --build
#   GUI: http://localhost:6080/vnc.html
#   API: http://localhost:8000/docs
# ─────────────────────────────────────────────────────────────────────────────
version: "3.9"

services:
  mediarenamer:
    build: .
    image: mediarenamer:latest
    container_name: mediarenamer
    ports:
      - "6080:6080"   # noVNC web GUI
      - "8000:8000"   # FastAPI REST + Swagger UI
    environment:
      - TMDB_API_KEY=${TMDB_API_KEY:-}
      - TVDB_API_KEY=${TVDB_API_KEY:-}
      - OPENSUBTITLES_API_KEY=${OPENSUBTITLES_API_KEY:-}
      - XVFB_RESOLUTION=${XVFB_RESOLUTION:-1440x900x24}
      - API_PORT=8000
      - API_HOST=0.0.0.0
    volumes:
      - ${HOME}/.mediarenamer:/root/.mediarenamer
      - ${MEDIA_DIR:-~/Media}:/media
    restart: "no"
    shm_size: "256mb"

  # ── API-only mode (no GUI, lighter image use) ─────────────────────────────
  # Uncomment to run headless API only:
  # mediarenamer-api:
  #   build: .
  #   image: mediarenamer:latest
  #   command: ["api"]
  #   ports:
  #     - "8000:8000"
  #   environment:
  #     - TMDB_API_KEY=${TMDB_API_KEY:-}
  #   volumes:
  #     - ${HOME}/.mediarenamer:/root/.mediarenamer
  #     - ${MEDIA_DIR:-~/Media}:/media
